<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Job List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        .job-status-Running { color: #0d6efd; font-weight: bold; }
        .job-status-Done { color: #198754; }
        .job-status-Paused { color: #ffc107; font-weight: bold; }
        .job-status-Queued { color: #6c757d; }
        .job-action-btn { margin-right: 0.5em; }
    </style>
</head>
<body>
<div class="container mt-4">
    <h2>Job List</h2>
    <table class="table table-bordered table-sm align-middle" id="job-table">
        <thead class="table-light">
        <tr>
            <th>Job ID</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Run Time (s)</th>
            <th>CPU (%)</th>
            <th>Memory (MB)</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <!-- Jobs inserted here -->
        </tbody>
    </table>
</div>
<script>
async function fetchJobs() {
    const resp = await fetch('/jobs');
    const data = await resp.json();
    const tbody = document.querySelector('#job-table tbody');
    tbody.innerHTML = '';
    for (const job of data.jobs) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${job.job_id}</td>
            <td>${job.priority}</td>
            <td class="job-status-${job.status}">${job.status}</td>
            <td>${job.run_time ? job.run_time.toFixed(2) : ''}</td>
            <td>${job.cpu !== null && job.cpu !== undefined ? job.cpu : ''}</td>
            <td>${job.mem !== null && job.mem !== undefined ? (job.mem / 1024 / 1024).toFixed(2) : ''}</td>
            <td>
                <button class="btn btn-warning btn-sm job-action-btn" onclick="jobAction('${job.job_id}', 'pause')">Pause</button>
                <button class="btn btn-success btn-sm job-action-btn" onclick="jobAction('${job.job_id}', 'resume')">Resume</button>
                <button class="btn btn-danger btn-sm job-action-btn" onclick="jobAction('${job.job_id}', 'cancel')">Cancel</button>
            </td>
        `;
        tbody.appendChild(tr);
    }
}

async function jobAction(job_id, action) {
    await fetch('/job_action', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ job_id, action })
    });
    fetchJobs();
}

fetchJobs();
setInterval(fetchJobs, 2000);
</script>
</body>
</html>
