<!DOCTYPE html>
<html>
<head>
    <title>Jobs - GNY DataWarehouse NexGen</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/static/gny_style.css">
</head>
<body>
    {{ navbar|safe }}
    {{ menu|safe }}
    <div class="main-content">
      <h2 class="main-title">Job List</h2>
      <table class="jobs-table" id="job-table">
        <thead class="table-light">
          <tr>
            <th>Job ID</th>
            <th>Priority</th>
            <th>Status</th>
            <th>Run Time (s)</th>
            <th>CPU (%)</th>
            <th>Memory (MB)</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Jobs inserted here -->
        </tbody>
      </table>
    </div>
    <script>
    async function fetchJobs() {
        const resp = await fetch('/jobs/status');
        const data = await resp.json();
        const tbody = document.querySelector('#job-table tbody');
        tbody.innerHTML = '';
        for (const job of data.jobs) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${job.job_id}</td>
                <td>${job.priority}</td>
                <td class="job-status-${job.status}">${job.status}</td>
                <td>${job.run_time ? job.run_time.toFixed(2) : ''}</td>
                <td>${job.cpu !== null && job.cpu !== undefined ? job.cpu : ''}</td>
                <td>${job.mem !== null && job.mem !== undefined ? (job.mem / 1024 / 1024).toFixed(2) : ''}</td>
                <td>
                    <button class="btn btn-warning btn-sm job-action-btn" onclick="jobAction('${job.job_id}', 'pause')">Pause</button>
                    <button class="btn btn-success btn-sm job-action-btn" onclick="jobAction('${job.job_id}', 'resume')">Resume</button>
                    <button class="btn btn-danger btn-sm job-action-btn" onclick="jobAction('${job.job_id}', 'cancel')">Cancel</button>
                </td>
            `;
            tbody.appendChild(tr);
        }
    }

    async function jobAction(job_id, action) {
        await fetch('/jobs/action', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ job_id, action })
        });
        fetchJobs();
    }

    fetchJobs();
    setInterval(fetchJobs, 2000);
    </script>
</body>
</html>

